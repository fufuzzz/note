# Linux命令

#### 一.Linux命令-用户、权限管理

 用户是Unix/Linux系统工作中重要的一环，用户管理包括用户与组账号的管理。

在Unix/Linux系统中，不论是由本机或是远程登录系统，每个系统都必须拥有一个账号，并且对于不同的系统资源拥有不同的使用权限。

Unix/Linux系统中的root账号通常用于系统的维护和管理，它对Unix/Linux操作系统的所有具有不受限制的访问权限。

在Unix/Linux安装的过程中，系统会自动创建许多用户账号，而这些默认的用户就称为“标准用户”。

在大多数版本的Unix/Linux中，都不推荐直接使用root账号登录系统。

##### 1>查看当前用户：whoami

whoami该命令用户查看当前系统当前账号的用户名。可通过cat /etc/passwd查看系统用户信息。

由于系统管理员通常需要使用多种身份登录系统，例如通常使用普通用户登录系统，然后再以su命令切换到root身份对传统进行管理。这时候就可以使用whoami来查看当前用户的身份。

> 例如：

```shell
> whoami
```



##### 2>查看登录用户：who

who命令用于查看当前所有登录系统的用户信息。

> who命令用来打印当前登录用户信息，包含了系统的启动时间 、 活动进程 、 使用者 ID、使用终端等信息，是系统管理员了解系统运行状态的常用命令。

常用选项：

| 选项           | 含义                       |
| ------------ | ------------------------ |
| -m或am I      | 只显示运行who命令的用户名、登录终端和登录时间 |
| -q或--count   | 只显示用户的登录账号和登录用户的数量       |
| -H或--heading | 显示列标题                    |

> 例如：

```shell
> who
```



##### 3>退出登录账户： exit

如果是图形界面，退出当前终端；

如果是使用ssh远程登录，退出登陆账户；

如果是切换后的登陆用户，退出则返回上一个登陆账号。



 #####4>添加用户账号：useradd

在Unix/Linux中添加用户账号可以使用adduser或useradd命令，因为adduser命令是指向useradd命令的一个链接，因此，这两个命令的使用格式完全一样。

useradd命令的使用格式如下： useradd [参数] 新建用户账号

| 参数   | 含义                                       |
| ---- | ---------------------------------------- |
| -d   | 指定用户登录系统时的主目录，如果不使用该参数，系统自动在/home目录下建立与用户名同名目录为主目录 |
| -m   | 自动建立目录                                   |
| -g   | 指定组名称                                    |

相关说明：

- Linux每个用户都要有一个主目录，主目录就是第一次登陆系统，用户的默认当前目录(/home/用户)；
- 每一个用户必须有一个主目录，所以用useradd创建用户的时候，一定给用户指定一个主目录；
- 用户的主目录一般要放到根目录的home目录下，用户的主目录和用户名是相同的；
- 如果创建用户的时候，不指定组名，那么系统会自动创建一个和用户名一样的组名。


| 命令                              | 含义                                       |
| ------------------------------- | ---------------------------------------- |
| useradd -d /home/abc abc -m     | 创建abc用户，如果/home/abc目录不存在，就自动创建这个目录，同时用户属于abc组 |
| useradd -d /home/a a -g test -m | 创建一个用户名字叫a，主目录在/home/a，如果主目录不存在，就自动创建主目录，同时用户属于test组 |
| cat /etc/passwd                 | 查看系统当前用户名                                |

> 例如：

```shell
#添加一个python用户，并且创建其家目录
> sudo useradd python -m -d /home/python
```

sudo：管理员权限

##### 5>设置用户密码：passwd

在Unix/Linux中，超级用户可以使用passwd命令为普通用户设置或修改用户口令。用户也可以直接使用该命令来修改自己的口令，而无需在命令后面使用用户名。

```shell
#给python用户设置密码
>sudo passwd python
```



> 创建一个用户名lili，家目录/home/lili  ,给用户lili设置密码，使用lili来登录终端，然后在桌面创建一个hello.py的文件。然后切换到原始用户，此时查看当前用户，使用当前用户将lili用户创建的hello.py文件删除。



##### 6>删除用户：userdel

| 命令                  | 含义                    |
| ------------------- | --------------------- |
| userdel abc(用户名)    | 删除abc用户，但不会自动删除用户的主目录 |
| userdel -r abc(用户名) | 删除用户，同时删除用户的主目录       |

> 例如：

```shell
#删除python用户以及其用户主目录
>userdel -r  python
```



 #####7>切换用户：su

可以通过su命令切换用户，su后面可以加“-”。su和su –命令不同之处在于，su -切换到对应的用户时会将当前的工作目录自动转换到切换后的用户主目录：

 注意：如果是ubuntu平台，需要在命令前加“sudo”，如果在某些操作需要管理员才能操作，ubuntu无需切换到root用户即可操作，只需加“sudo”即可。sudo是ubuntu平台下允许系统管理员让普通用户执行一些或者全部的root命令的一个工具，减少了root 用户的登陆和管理时间，提高了安全性。

| 命令        | 含义                     |
| --------- | ---------------------- |
| su        | 切换到root用户              |
| su root   | 切换到root用户              |
| su -      | 切换到root用户，同时切换目录到/root |
| su - root | 切换到root用户，同时切换目录到/root |
| su 普通用户   | 切换到普通用户                |
| su - 普通用户 | 切换到普通用户，同时切换普通用户所在的目录  |

Ubuntu下切换到root的简单命令:

```shell
#切换到root用户
> sudo - root
```

> 若出现错误： user is not in the sudoers file. This incident will be reported.
>
> 解决方法：在sudoers文件中添加该用户
>
> 1. sudoers默认是只读的， 对root也是只读， 切换到root用户下， 执行命令：chmod u+w /etc/sudoers
>
> 2. 编辑sudoers文件， 执行：vim /etc/sudoers, 
>
>    进入后找到这行 root ALL=(ALL) ALL,
>
>    在他下面添加 xxx ALL=(ALL) ALL (这里的xxx是你的用户名)
>
> 3. 撤销sudoers文件写权限, 执行命令:
>    chmod u-w /etc/sudoers

需求：

1.给root用户重置密码

sudo passwd root

2.登陆root用户，使用root用户创建一个新的用户newuser

su - root

3.给新的用户重置密码

passwd newuser

4.退出root用户 exit

5.使用新用户登录  su jack

6.将新用户删除  sudo userdel -r jack



#####8>查看有哪些用户组

```
>cat /etc/group
```



##### 9>添加、删除组账号：groupadd、groupdel

groupadd 新建组账号 groupdel 组账号 cat /etc/group 查看用户组

```shell
#添加组号
>sudo groupadd hehe
>sudo groupdel hehe
```



##### 10>修改用户所在组：usermod

使用方法：usermod -g 用户组 用户名

```shell
#将用户python2修改到python组
> sudo usermod -g python python2
#查看信息
>cat /etc/group 
```



##### 11>查看用户在哪个组

```shell
#查看用户所在组
> groups lili
```



##### 12>修改文件权限：chmod

```
Linux文件权限： r, w, x

drwxr-xr-x  2 jerry python1908 4096 11月  6 10:43 jerry/
文件权限： rwxr-xr-x
分三组： 
	第一组(文件所有者的权限)：rwx 
	第二组(所属用户组的权限)：r-x
	第三组(其他用户组的权限): r-x
权限：
	r(4),w(2),x(1)
	--- (000): 0
	--x (001): 1
	-w- (010): 2
	-wx (011): 3
	r-- (100): 4
	r-x (101): 5
	rw- (110): 6
	rwx (111): 7
	
```



chmod 修改文件权限有两种使用格式：字母法与数字法。

字母法：chmod u/g/o/a +/-/= rwx 文件

| [ u/g/o/a ] | 含义                                   |
| ----------- | ------------------------------------ |
| u           | user 表示该文件的所有者                       |
| g           | group 表示与该文件的所有者属于同一组( group )者，即用户组 |
| o           | other 表示其他以外的人                       |
| a           | all 表示这三者皆是                          |

| [ +-= ] | 含义   |
| ------- | ---- |
| +       | 增加权限 |
| -       | 撤销权限 |
| =       | 设定权限 |

| rwx  | 含义                                       |
| ---- | ---------------------------------------- |
| r    | read 表示可读取，对于一个目录，如果没有r权限，那么就意味着不能通过ls查看这个目录的内容。 |
| w    | write 表示可写入，对于一个目录，如果没有w权限，那么就意味着不能在目录下创建新的文件。 |
| x    | excute 表示可执行，对于一个目录，如果没有x权限，那么就意味着不能通过cd进入这个目录。 |

> 
>
> 例如

```shell
> touch test.txt
>ls -lh
>chmod u+x test.txt
>ls -lh
```

如果需要同时进行设定拥有者、同组者以及其他人的权限，参考如下：

```shell
>chmod u=rw,g=x,o=r test.txt
```

```shell
>chmod u=,g=,o=  test.txt
```

数字法：“rwx” 这些权限也可以用数字来代替**

| 字母   | 说明               |
| ---- | ---------------- |
| r    | 读取权限，数字代号为 "4"   |
| w    | 写入权限，数字代号为 "2"   |
| x    | 执行权限，数字代号为 "1"   |
| -    | 不具任何权限，数字代号为 "0" |

如执行：chmod u=rwx,g=rx,o=r filename 

chmod 751 file：

- 文件所有者：读、写、执行权限
- 同组用户：读、执行的权限
- 其它用户：执行的权限

```shell
> chmod 777 test.txt
```

注意：如果想递归所有目录加上相同权限，需要加上参数“ -R ”。 如：chmod 777 test/ -R 递归 test 目录下所有文件加 777 权限



##### 13> 修改文件所有者：chown

```shell
> sudo chown python test.txt
```



#####14>修改文件所属组：chgrp

```shell
> sudo chgrp python test.txt
```

练习：

1.创建一个hello.py文件

2.给hello.py添加可执行权限，修改文件的权限，本用户可读可写可执行，同组用户只读

其他用户什么都干不了。

3.执行该hello.py文件

4.修改该文件所有者，修改为user1，修改文件的所在组，修改user2

5. 自行测试修改的权限是否正确

   ​

#### 二、Linux命令-系统管理

##### 1>查看当前日历：cal

cal命令用于查看当前日历，-y显示整年日历：

```
cal
#查看当前月份的日历
```

```
cal -y 2019
#查看2019整年的日历
```

##### 2>显示或设置时间：date

设置时间格式（需要管理员权限）：

`date [MMDDhhmm[[CC]YY][.ss]] +format`

CC为年前两位yy为年的后两位，前两位的mm为月，后两位的mm为分钟，dd为天，hh为小时，ss为秒。如： date 010203042022.55。

 #####3>查看进程信息：ps

进程是一个具有一定独立功能的程序，它是操作系统动态执行的基本单元。

ps命令可以查看进程的详细状况，常用选项(选项可以不加“-”)如下：

| 选项   | 含义                   |
| ---- | -------------------- |
| -a   | 显示终端上的所有进程，包括其他用户的进程 |
| -u   | 显示进程的详细状态            |
| -x   | 显示没有控制终端的进程          |
| -w   | 显示加宽，以便显示更多的信息       |

> 例如：

```shell
> ps -aux
> ps -ef | grep 'python'
```



##### 4>动态显示进程：top

top命令用来动态显示运行中的进程。top命令能够在运行后，在指定的时间间隔更新显示信息。可以在使用top命令时加上-d 来指定显示信息更新的时间间隔。

在top命令执行后，可以按下按键得到对显示的结果进行排序：

| 按键   | 含义                 |
| ---- | ------------------ |
| M    | 根据内存使用量来排序         |
| P    | 根据CPU占有率来排序        |
| T    | 根据进程运行时间的长短来排序     |
| u    | 可以根据后面输入的用户名来筛选进程  |
| K    | 可以根据后面输入的PID来杀死进程。 |
| q    | 退出                 |
| h    | 获得帮助               |



##### 5>终止进程：kill

kill命令指定进程号的进程，需要配合 ps 使用。

使用格式：

```shell
kill [-signal] pid
```

信号值从0到15，其中9为绝对终止，可以处理一般信号无法终止的进程。

kill 9133 ：9133 为应用程序所对应的进程号

> 注意：有些进程不能直接杀死，这时候我们需要加一个参数“ -9 ”，“ -9 ” 代表强制结束
>
> 

##### 6>关机 重启：reboot、shutdown、init

| 命令                | 含义                        |
| ----------------- | ------------------------- |
| reboot            | 重新启动操作系统                  |
| shutdown –r now   | 重新启动操作系统，shutdown会给别的用户提示 |
| shutdown -h now   | 立刻关机，其中now相当于时间为0的状态      |
| shutdown -h 20:25 | 系统在今天的20:25 会关机           |
| shutdown -h +10   | 系统再过十分钟后自动关机              |
| init 0            | 关机                        |
| init 6            | 重启                        |

 ##### 7>检测磁盘空间：df

df命令用于检测文件系统的磁盘空间占用和空余情况，可以显示所有文件系统对节点和磁盘块的使用情况。

| 选项   | 含义                   |
| ---- | -------------------- |
| -a   | 显示所有文件系统的磁盘使用情况      |
| -m   | 以1024字节为单位显示         |
| -t   | 显示各指定文件系统类型的磁盘空间使用情况 |
| -T   | 显示文件系统               |

文件系统              容量  已用 可用 已用% 挂载点

##### 8>检测目录所占磁盘空间：du

du命令用于统计目录或文件所占磁盘空间的大小，该命令的执行结果与df类似，du更侧重于磁盘的使用状况。

du命令的使用格式如下： du [选项] 目录或文件名

计算每个文件的磁盘用量，目录则取总用量

| 选项   | 含义                        |
| ---- | ------------------------- |
| -a   | 递归显示指定目录中各文件和子目录中文件占用的数据块 |
| -s   | 显示指定文件或目录占用的数据块           |
| -b   | 以字节为单位显示磁盘占用情况            |
| -l   | 计算所有文件大小，对硬链接文件计算多次       |



##### 9>查看或配置网卡信息：ifconfig

如果，我们只是敲：ifconfig，它会显示所有网卡的信息：

```shell
>ifconfig
#修改ens33的ip
>sudo ifconfig ens33 192.168.1.108
```



##### 10>测试远程主机连通性：ping

声呐

```shell
>ping www.biadu.com
>ping 192.168.1.1
```

ctrl＋c 退出



#### 三、gedit编辑器

gedit是一个Linux环境下的文本编辑器，类似windows下的写字板程序，在不需要特别复杂的编程环境下，作为基本的文本编辑器比较合适。

```shell
>gedit 1.txt
```



#### 四、编辑器之神-vim

##### vi简介

vi是“Visual interface”的简称，它在Linux上的地位就仿佛Edit程序在DOS上一样。它可以执行输出、删除、查找、替换、块操作等众多文本操作，而且用户可以根据自己的需要对其进行定制。Vi不是一个排版程序，它不象Word或WPS那样可以对字体、格式、段落等其他属性进行编排，它只是一个文本编辑程序。 vi没有菜单，只有命令，且命令繁多。

```
Vi有三种基本工作模式：
1. 命令模式
2. 文本输入模式
3. 末行模式
```



##### 命令行模式：按ESC即可进入命令行模式

任何时候，不管用户处于何种模式，只要按一下ESC键，即可使Vi进入命令模式；我们在shell环境(提示符为$)下输入启动Vi命令，进入编辑器时，也是处于该模式下。在该模式下，用户可以输入各种合法的Vi命令，用于管理自己的文档。此时从键盘上输入的任何字符都被当做编辑命令来解释，若输入的字符是合法的Vi命令，则Vi在接受用户命令之后完成相应的动作。但需注意的是，所输入的命令并不在屏幕上显示出来。若输入的字符不是Vi的合法命令，Vi会响铃报警。

 #####文本输入模式

在命令模式下输入插入命令i、附加命令a 、打开命令o、修改命令c、取代命令r或替换命令s都可以进入文本输入模式。在该模式下，用户输入的任何字符都被Vi当做文件内容保存起来，并将其显示在屏幕上。在文本输入过程中，若想回到命令模式下，按键ESC即可。

##### 末行模式

末行模式也称ex转义模式。在命令模式下，用户按“:”键即可进入末行模式下，此时Vi会在显示窗口的最后一行(通常也是屏幕的最后一行)显示一个“:”作为末行模式的提示符，等待用户输入命令。多数文件管理命令都是在此模式下执行的(如把编辑缓冲区的内容写到文件中等)。末行命令执行完后，Vi自动回到命令模式。例如：

```
  :sp newfile
```

则分出一个窗口编辑newfile文件。如果要从命令模式转换到编辑模式，可以键入命令a或者i；如果需要从文本模式返回，则按Esc键即可。在命令模式下输入“:”即可切换到末行模式，然后输入命令。

 #####vim基础操作

vim是从 vi 发展出来的一个文本编辑器 。代码补完、编译及错误跳转等方便编程的功能特别丰富

进入插入模式:

```
i: 【*】插入光标前一个字符
I: 【*】插入行首 
a: 【*】插入光标后一个字符 
A: 【*】插入行未 
o: 【*】向下新开一行,插入行首 
O: 【*】向上新开一行,插入行首
```

进入命令模式:

ESC:从插入模式或末行模式进入命令模式

移动光标:

```
h: 左移 
j: 下移 
k: 上移 
l: 右移
M: 光标移动到中间行 
L: 光标移动到屏幕最后一行行首 
w: 向后一次移动一个字 
b: 向前一次移动一个字
{: 按段移动,上移 
}: 按段移动,下移
Ctrl＋d: 向下翻半屏  down
Ctrl＋u: 向上翻半屏  up
Ctrl＋f: 向下翻一屏  forward
Ctrl＋b: 向上翻一屏  back

gg: 【*】光标移动文件开头 
G: 【*】光标移动到文件末尾   小写模式按：shift + g 就是 G
```

删除命令:

```
x: 删除光标后一个字符,相当于 Del 
X: 【*】删除光标前一个字符,相当于 Backspace
dd: 【*】删除光标所在行,n dd 删除指定的行数
D: 删除光标后本行所有内容,包含光标所在字符 
d0: 删除光标前本行所有内容,不包含光标所在字符
```

 撤销命令:

```
u: 【*】一步一步撤销 
Ctrl＋r: 【*】反撤销
```

 文本行移动:

```
>>: 文本行右移  一次移动8个字符
<<: 文本行左移
```

复制粘贴:

```
yy: 【*】复制当前行,n yy 复制 第n 行 
p: 【*】在光标所在位置向下新开辟一行,粘贴
```

替换操作:

```
r: 替换当前字符 
R: 替换当前行光标后的字符，从当前光标开始向后进行替换
```

查找命令:

```
/ 【*】str查找
n: 下一个
N：上一个
```

替换命令：

把abc全部替换成123 【*】类似windows中的Ctrl+F

```
末行模式下，将文件中全部的abc替换成123 
:%s/abc/123/g

末行模式下，将第一行至第10行之间的abc替换成123
:1, 10s/abc/123/g
```

vim里执行 shell 下命令:

```
末行模式里输入!,后面跟命令
wq！ 强制保存并退出
q！【*】 强制退出
wq 【*】保存并退出
```

> 创建一个txt文件，复制文件的前五行，空一行粘贴，进入到第二段，移动第二段的前两行，向后移动4个tab键，然后查找第二段中含有str的字符串，将str字符串替换成string。

##### 作业

1. 查看当前Ubuntu的系统时间

2. 把命令cal执行后看到的结果存放到 cal.txt文件中

3. 创建一个文件 test.txt，修改其权限为 所有者可读可写，其他人没有任何权限

4. 创建一个叫xiaohua的用户，然后创建一个新的用户组叫nba，并将xiaohua用户添加到这个用户组中，然后创建一个新的文件，名字叫molei.py，并修它的用户组为nba

   ​



#### 五、ubuntu软件安装与卸载

#####1.Ubuntu软件安装

```shell
sudo apt update 【*】更新源 
sudo apt install package 【*】安装包
sudo apt remove package 【*】删除包
sudo apt-cache search package 搜索软件包
sudo apt-cache show package  获取包的相关信息，如说明、大小、版本等
sudo apt-get install package --reinstall   重新安装包
sudo apt-get -f install   修复安装
sudo apt-get remove package --purge 删除包，包括配置文件等
sudo apt-get build-dep package 安装相关的编译环境
sudo apt-get upgrade 更新已安装的包
sudo apt-get dist-upgrade 升级系统
sudo apt-cache depends package 了解使用该包依赖那些包
sudo apt-cache rdepends package 查看该包被哪些包依赖
sudo apt-get source package  下载该包的源代码
sudo apt-get clean && sudo apt-get autoclean 清理无用的包
sudo apt-get check 检查是否有损坏的依赖
```

##### Ubuntu 下安装

在 Ubuntu 系统安装 Redis 可以使用以下命令:

```
$sudo apt update
$sudo apt install redis-server
```

##### 启动 Redis

```
$redis-server
```

##### 查看 redis 是否启动？

```
$redis-cli
```

以上命令将打开以下终端：

```
redis 127.0.0.1:6379>
```

127.0.0.1 是本机 IP ，6379 是 redis 服务端口。现在我们输入 PING 命令。

```
redis 127.0.0.1:6379> ping
PONG
```

以上说明我们已经成功安装了redis。

